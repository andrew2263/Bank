"use strict";!function(){var e,t,r,a,c=document.querySelector(".calculator"),l=c.querySelector(".calculator__goal"),o=document.querySelector(".calculator__select"),n=c.querySelector(".calculator__list"),u=c.querySelector(".calculator__input"),s=c.querySelectorAll(".calculator__link"),i=c.querySelectorAll(".calculator__credit"),_=c.querySelectorAll(".calculator__price-button"),d=c.querySelectorAll(".calculator__initial-range"),p=c.querySelectorAll(".calculator__term-range"),m=c.querySelectorAll(".calculator__price-input_price"),g=c.querySelectorAll(".calculator__price-input_initial"),v=c.querySelectorAll(".calculator__price-input_term"),y=c.querySelector(".calculator__offer"),q=c.querySelector(".calculator__offer-request"),f=c.querySelector(".calculator__request"),N=c.querySelectorAll(".calculator__checkbox"),S=!1,L=c.querySelector(".calculator__form"),I=localStorage,h=[],b={mortgage:"Сумма ипотеки",car:"Сумма автокредита",consumer:"Сумма кредита"},E={mortgage:"Стоимость недвижимости",car:"Стоимость автомобиля",consumer:"Сумма потребительского кредита"},k=(r=1,function(){return S?++r:r});l.addEventListener("click",function(e){e.preventDefault(),l.classList.toggle("calculator__goal_expanded"),n.classList.toggle("calculator__list_expanded")});for(var T=0;T<s.length;T++)s[T].addEventListener("click",function(r){r.preventDefault(),y.classList.remove("calculator__offer_active"),f.classList.remove("calculator__request_active"),c.querySelector(".calculator__message_mortgage").classList.remove("calculator__message_active"),c.querySelector(".calculator__message_car").classList.remove("calculator__message_active");for(var s=0;s<i.length;s++)i[s].classList.remove("calculator__credit_active"),i[s].classList.remove("in");var _=r.target.getAttribute("href").slice(1);e=document.getElementById(_),t=_,e.classList.add("calculator__credit_active"),setTimeout(function(){e.classList.add("in")},150),l.classList.remove("calculator__goal_expanded"),n.classList.remove("calculator__list_expanded"),l.innerHTML=r.target.innerHTML,u.value=r.target.innerHTML,y.querySelector(".calculator__offer-text_credit").innerHTML=b[_],o.classList.add("calculator__select_active"),y.classList.add("calculator__offer_active"),a=F(e,t)});for(var B=0;B<_.length;B++)_[B].addEventListener("click",function(r){r.preventDefault();var c=r.target.parentNode.querySelector(".calculator__price-input");parseInt(Number(c.value)+Number(r.target.dataset.add),10)<c.dataset.min||parseInt(Number(c.value)+Number(r.target.dataset.add),10)>c.dataset.max||c.classList.contains("calculator__price-input_red")||(c.value=parseInt(Number(c.value)+Number(r.target.dataset.add),10),j(c),a=F(e,t)),c.classList.contains("calculator__price-input_red")&&(c.classList.remove("calculator__price-input_red"),c.parentNode.parentNode.classList.remove("calculator__price_red"),c.value=(c.dataset.max-c.dataset.min)/2,j(c),a=F(e,t))});for(var M=0;M<d.length;M++)d[M].addEventListener("input",function(r){var c=Number(r.target.value)/100,l=r.target.parentNode.parentNode.querySelector(".calculator__price-wrapper").querySelector(".calculator__price-input").value,o=r.target.parentNode.querySelector(".calculator__price-input");o.value=parseInt(l*c,10),r.target.parentNode.querySelector(".calcualor__initial-percent").innerHTML=r.target.value+"%";var n=o.parentNode.querySelector(".calculator__price-currency");G(parseInt(o.value,10),n,"roubles"),a=F(e,t)});for(var H=0;H<p.length;H++)p[H].addEventListener("input",function(r){var c=r.target.parentNode.querySelector(".calculator__price-input");c.value=r.target.value;var l=c.parentNode.querySelector(".calculator__price-years");G(parseInt(c.value,10),l,"years"),a=F(e,t)});for(var x=0;x<m.length;x++)m[x].addEventListener("input",function(e){j(e.target)});for(var A=0;A<m.length;A++)m[A].addEventListener("change",function(r){z(r.target);var c=r.target.parentNode.querySelector(".calculator__price-currency");G(parseInt(r.target.value,10),c,"roubles"),a=F(e,t)});for(var w=0;w<m.length;w++)m[w].addEventListener("focus",function(e){e.target.parentNode.parentNode.classList.contains("calculator__price_red")&&e.target.classList.contains("calculator__price-input_red")&&(e.target.parentNode.parentNode.classList.remove("calculator__price_red"),e.target.classList.remove("calculator__price-input_red"),e.target.value=(e.target.dataset.max-e.target.dataset.min)/2)});for(var D=0;D<g.length;D++)g[D].addEventListener("change",function(r){C(r.target);var c=r.target.parentNode.querySelector(".calculator__price-currency");G(parseInt(r.target.value,10),c,"roubles"),a=F(e,t)});for(var J=0;J<v.length;J++)v[J].addEventListener("change",function(r){var c=parseInt(r.target.parentNode.parentNode.parentNode.querySelector(".calculator__term-range").min,10),l=parseInt(r.target.parentNode.parentNode.parentNode.querySelector(".calculator__term-range").max,10);parseInt(r.target.value,10)<c&&(r.target.value=c),parseInt(r.target.value,10)>l&&(r.target.value=l);var o=r.target.parentNode.querySelector(".calculator__price-years");G(parseInt(r.target.value,10),o,"years"),a=F(e,t)});for(var O=0;O<N.length;O++)N[O].addEventListener("change",function(){a=F(e,t)});var j=function(e){if(e.parentNode.parentNode.parentNode.parentNode.querySelector(".calculator__price-input_initial")){var t=e.parentNode.parentNode.parentNode.parentNode.querySelector(".calculator__price-input_initial"),r=e.parentNode.parentNode.parentNode.parentNode.querySelector(".calculator__initial-range").value;t.value=parseInt(Number(e.value)*Number(r/100),10);var a=t.parentNode.querySelector(".calculator__price-currency");G(parseInt(t.value,10),a,"roubles")}},z=function(e){var t=parseInt(e.value,10);(t<parseInt(e.dataset.min,10)||t>parseInt(e.dataset.max,10))&&(e.parentNode.parentNode.classList.add("calculator__price_red"),e.classList.add("calculator__price-input_red"),e.value="Некорректное значение")},C=function(e){var t=parseInt(e.parentNode.parentNode.parentNode.querySelector(".calculator__initial-range").min,10),r=parseInt(e.parentNode.parentNode.parentNode.querySelector(".calculator__initial-range").max,10),a=parseInt(e.parentNode.parentNode.parentNode.parentNode.querySelector(".calculator__price-input_price").value,10);parseInt(e.value,10)<parseInt(a*t/100,10)&&(e.value=parseInt(a*t/100,10)),parseInt(e.value,10)>parseInt(a*r/100,10)&&(e.value=parseInt(a*r/100,10))},F=function(e,t){var r,a,l=y.querySelector(".calculator__offer-sum"),o=y.querySelector(".calculator__offer-month"),n=y.querySelector(".calculator__offer-percent"),u=y.querySelector(".calculator__offer-salary"),s=0,i=0,_=document.getElementById("calculator-checkbox-casco"),d=document.getElementById("calculator-checkbox-lifesafe"),p=parseInt(e.querySelector(".calculator__price-input_price").value,10);if(e.querySelector(".calculator__price-input_initial"))var m=parseInt(e.querySelector(".calculator__price-input_initial").value,10);var g=parseInt(e.querySelector(".calculator__price-input_term").value,10);switch(y.classList.remove("calculator__offer_active"),f.classList.remove("calculator__request_active"),c.querySelector(".calculator__message_mortgage").classList.remove("calculator__message_active"),c.querySelector(".calculator__message_car").classList.remove("calculator__message_active"),t){case"mortgage":s=p-m,document.getElementById("calculator-checkbox-mortgage").checked&&(s-=document.getElementById("calculator-checkbox-mortgage").dataset.sum),parseInt(e.querySelector(".calculator__initial-range").value,10)<15&&(i=9.4),parseInt(e.querySelector(".calculator__initial-range").value,10)>=15&&(i=8.5);break;case"car":s=p-m,_.checked||d.checked||(p<2e6&&(i=16),p>=2e6&&(i=15)),(_.checked&&!d.checked||!_.checked&&d.checked)&&(i=8.5),_.checked&&d.checked&&(i=3.5);break;case"consumer":s=p,p<75e4&&(i=15),p>=75e4&&p<2e6&&(i=12.5),p>=2e6&&(i=9.5),document.getElementById("calculator-checkbox-salary").checked&&(i-=.5);break;default:s=p}var v=!1;switch(t){case"mortgage":s>=5e5&&(v=!0);break;case"car":s>=2e5&&(v=!0);break;case"consumer":v=!0;break;default:v=!1}if(!v)switch(t){case"mortgage":c.querySelector(".calculator__message_mortgage").classList.add("calculator__message_active");break;case"car":c.querySelector(".calculator__message_car").classList.add("calculator__message_active")}var q=i/100/12,N=12*g;return r=parseInt(s*(q+q/(Math.pow(1+q,N)-1)),10),a=parseInt(r/.45,10),v&&(o.innerHTML=r,l.innerHTML=s,n.innerHTML=i,u.innerHTML=a,G(r,o.parentNode.querySelector(".calculator__offer-currency"),"roubles"),G(s,l.parentNode.querySelector(".calculator__offer-currency"),"roubles"),G(a,u.parentNode.querySelector(".calculator__offer-currency"),"roubles"),y.classList.add("calculator__offer_active")),{goal:e.dataset.type,creditType:t,price:p,initial:m,term:g}};q.addEventListener("click",function(e){e.preventDefault();var t=k(),r=t.toString().length,l="";if(r<4)for(var o=4-r;0!==o;)l+="0",o--;l+=t.toString(),document.getElementById("request-initial").innerHTML="",document.getElementById("request-initial").parentNode.querySelector(".calculator__request-currency").innerHTML="",f.classList.add("calculator__request_active"),document.getElementById("request-goal").innerHTML=a.goal,document.getElementById("request-number").innerHTML=l,document.getElementById("request-price").parentNode.parentNode.querySelector(".calculator__descr").innerHTML=E[a.creditType],document.getElementById("request-price").innerHTML=a.price,document.getElementById("request-price").innerHTML=a.price,G(a.price,document.getElementById("request-price").parentNode.querySelector(".calculator__request-currency"),"roubles"),a.initial&&(document.getElementById("request-initial").innerHTML=a.initial,G(a.initial,document.getElementById("request-initial").parentNode.querySelector(".calculator__request-currency"),"roubles")),document.getElementById("request-term").innerHTML=a.term,G(a.term,document.getElementById("request-term").parentNode.querySelector(".calculator__request-years"),"years"),window.scrollTo({top:c.offsetTop+f.offsetTop,left:0,behavior:"smooth"})}),L.addEventListener("submit",function(e){e.preventDefault(),S=!0,k(),f.classList.remove("calculator__request_active"),y.classList.remove("calculator__offer_active"),S=!1;var t={name:document.getElementById("request-name").value,email:document.getElementById("request-email").value,tel:document.getElementById("request-tel").value};if(0===h.length&&I.getItem("requests"))for(var r=0;r<JSON.parse(I.getItem("requests")).length;r++)h.push(JSON.parse(I.getItem("requests"))[r]);h.push(t),I.setItem("requests",JSON.stringify(h))});var G=function(e,t,r){var a,c=e%100;switch(e%10){case 1:11!==c&&(a="a"),11===c&&(a="c");break;case 2:case 3:case 4:12!==c&&13!==c&&14!==c&&(a="b"),12!==c&&13!==c&&14!==c||(a="c");break;default:a="c"}switch(r){case"roubles":t.innerHTML={a:"рубль",b:"рубля",c:"рублей"}[a];break;case"years":t.innerHTML={a:"год",b:"года",c:"лет"}[a]}}}();