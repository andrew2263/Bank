"use strict";!function(){var e,t,r=document.querySelector(".calculator"),a=r.querySelector(".calculator__goal"),c=document.querySelector(".calculator__select"),l=r.querySelector(".calculator__list"),o=r.querySelector("#calculator-select"),n=r.querySelectorAll(".calculator__link"),u=r.querySelectorAll(".calculator__credit"),s=r.querySelectorAll(".calculator__price-button"),i=r.querySelectorAll(".calculator__initial-range"),_=r.querySelectorAll(".calculator__term-range"),d=r.querySelectorAll(".calculator__price_range"),p=r.querySelectorAll(".calculator__price_initial"),g=r.querySelectorAll(".calculator__price_term"),m=r.querySelector(".calculator__offer"),v=r.querySelector(".calculator__offer-request"),y=r.querySelector(".calculator__request"),q=r.querySelectorAll(".calculator__checkbox-group"),f=!1,S=r.querySelector("#calculator-form"),N=localStorage,L=[],I=[],h=[],b=[],E=[],k=[],T=[],B=function(e,t){for(var r=0;r<e.length;r++)for(var a=e[r].querySelectorAll("input"),c=0;c<a.length;c++)t.push(a[c]);return t};L=B(d,L),I=B(p,I),h=B(g,h),b=B(i,b),E=B(_,E),k=B(q,k);var M,H,x=(M=1,function(){return f?++M:M});a.addEventListener("click",function(e){e.preventDefault(),a.classList.toggle("calculator__goal_expanded"),l.classList.toggle("calculator__list_expanded")});for(var A=0;A<n.length;A++)n[A].addEventListener("click",function(n){n.preventDefault(),m.classList.remove("calculator__offer_active"),y.classList.remove("calculator__request_active"),r.querySelector(".calculator__message_mortgage").classList.remove("calculator__message_active"),r.querySelector(".calculator__message_car").classList.remove("calculator__message_active");for(var s=0;s<u.length;s++)u[s].classList.remove("calculator__credit_active"),u[s].classList.remove("in");var i=n.target.getAttribute("href").slice(1);e=document.getElementById(i),t=i,e.classList.add("calculator__credit_active"),setTimeout(function(){e.classList.add("in")},150),a.classList.remove("calculator__goal_expanded"),l.classList.remove("calculator__list_expanded"),a.innerHTML=n.target.innerHTML,o.value=n.target.innerHTML,m.querySelector(".calculator__offer-text_credit").querySelector("p").innerHTML=n.target.dataset.sumcredit,c.classList.add("calculator__select_active"),m.classList.add("calculator__offer_active"),H=P(e,t)});for(var w=0;w<s.length;w++)s[w].addEventListener("click",function(r){r.preventDefault();var a=r.target.parentNode.querySelector("input");parseInt(Number(a.value)+Number(r.target.dataset.add),10)<a.dataset.min||parseInt(Number(a.value)+Number(r.target.dataset.add),10)>a.dataset.max||a.classList.contains("calculator__price-input_red")||(a.value=parseInt(Number(a.value)+Number(r.target.dataset.add),10),F(a),H=P(e,t)),a.classList.contains("calculator__price-input_red")&&(a.classList.remove("calculator__price-input_red"),a.parentNode.parentNode.classList.remove("calculator__price_red"),a.value=(a.dataset.max-a.dataset.min)/2,F(a),H=P(e,t))});for(var D=0;D<b.length;D++)b[D].addEventListener("input",function(r){var a=Number(r.target.value)/100,c=r.target.parentNode.parentNode.parentNode.querySelector(".calculator__price-wrapper").querySelector("input").value,l=r.target.parentNode.parentNode.querySelector(".calculator__price_initial").querySelector("input");l.value=parseInt(c*a,10),r.target.parentNode.querySelector(".calcualor__initial-percent").querySelector("p").innerHTML=r.target.value+"%";var o=l.parentNode.querySelector(".calculator__price-currency");Q(parseInt(l.value,10),o,"roubles"),H=P(e,t)});for(var J=0;J<E.length;J++)E[J].addEventListener("input",function(r){var a=r.target.parentNode.parentNode.querySelector(".calculator__price_term").querySelector("input");a.value=r.target.value;var c=a.parentNode.querySelector(".calculator__price-years");Q(parseInt(a.value,10),c,"years"),H=P(e,t)});for(var O=0;O<L.length;O++)L[O].addEventListener("input",function(e){F(e.target)}),L[O].addEventListener("change",function(r){G(r.target);var a=r.target.parentNode.querySelector(".calculator__price-currency");Q(parseInt(r.target.value,10),a,"roubles"),H=P(e,t)}),L[O].addEventListener("focus",function(r){r.target.parentNode.parentNode.classList.contains("calculator__price_red")&&r.target.classList.contains("calculator__price-input_red")&&(r.target.parentNode.parentNode.classList.remove("calculator__price_red"),r.target.classList.remove("calculator__price-input_red"),r.target.value=(r.target.dataset.max-r.target.dataset.min)/2,F(r.target),H=P(e,t))});for(var j=0;j<I.length;j++)I[j].addEventListener("change",function(r){K(r.target);var a=r.target.parentNode.querySelector(".calculator__price-currency");Q(parseInt(r.target.value,10),a,"roubles"),H=P(e,t)});for(var z=0;z<h.length;z++)h[z].addEventListener("change",function(r){var a=parseInt(r.target.parentNode.parentNode.parentNode.querySelector(".calculator__term-range").querySelector("input").min,10),c=parseInt(r.target.parentNode.parentNode.parentNode.querySelector(".calculator__term-range").querySelector("input").max,10);parseInt(r.target.value,10)<a&&(r.target.value=a),parseInt(r.target.value,10)>c&&(r.target.value=c);var l=r.target.parentNode.querySelector(".calculator__price-years");Q(parseInt(r.target.value,10),l,"years"),H=P(e,t)});for(var C=0;C<k.length;C++)k[C].addEventListener("change",function(){H=P(e,t)});var F=function(e){if(e.parentNode.parentNode.parentNode.parentNode.querySelector(".calculator__price_initial")){var t=e.parentNode.parentNode.parentNode.parentNode.querySelector(".calculator__price_initial").querySelector("input"),r=e.parentNode.parentNode.parentNode.parentNode.querySelector(".calculator__initial-range").querySelector("input").value;t.value=parseInt(Number(e.value)*Number(r/100),10);var a=t.parentNode.querySelector(".calculator__price-currency");Q(parseInt(t.value,10),a,"roubles")}},G=function(e){var t=parseInt(e.value,10);(t<parseInt(e.dataset.min,10)||t>parseInt(e.dataset.max,10))&&(e.parentNode.parentNode.classList.add("calculator__price_red"),e.classList.add("calculator__price-input_red"),e.value="Некорректное значение")},K=function(e){var t=parseInt(e.parentNode.parentNode.parentNode.querySelector(".calculator__initial-range").querySelector("input").min,10),r=parseInt(e.parentNode.parentNode.parentNode.querySelector(".calculator__initial-range").querySelector("input").max,10),a=parseInt(e.parentNode.parentNode.parentNode.parentNode.querySelector(".calculator__price_range").querySelector("input").value,10);parseInt(e.value,10)<parseInt(a*t/100,10)&&(e.value=parseInt(a*t/100,10)),parseInt(e.value,10)>parseInt(a*r/100,10)&&(e.value=parseInt(a*r/100,10))},P=function(e,t){var a,c,l=m.querySelector(".calculator__offer-sum"),o=m.querySelector(".calculator__offer-month"),n=m.querySelector(".calculator__offer-percent"),u=m.querySelector(".calculator__offer-salary"),s=0,i=0,_=document.getElementById("calculator-checkbox-casco"),d=document.getElementById("calculator-checkbox-lifesafe"),p=parseInt(e.querySelector(".calculator__price_range").querySelector("input").value,10);if(e.querySelector(".calculator__price_initial"))var g=parseInt(e.querySelector(".calculator__price_initial").querySelector("input").value,10);var v=parseInt(e.querySelector(".calculator__price_term").querySelector("input").value,10);switch(m.classList.remove("calculator__offer_active"),y.classList.remove("calculator__request_active"),r.querySelector(".calculator__message_mortgage").classList.remove("calculator__message_active"),r.querySelector(".calculator__message_car").classList.remove("calculator__message_active"),t){case"mortgage":s=p-g,document.getElementById("calculator-checkbox-mortgage").checked&&(s-=document.getElementById("calculator-checkbox-mortgage").dataset.sum),parseInt(e.querySelector(".calculator__initial-range").querySelector("input").value,10)<15&&(i=9.4),parseInt(e.querySelector(".calculator__initial-range").querySelector("input").value,10)>=15&&(i=8.5);break;case"car":s=p-g,_.checked||d.checked||(p<2e6&&(i=16),p>=2e6&&(i=15)),(_.checked&&!d.checked||!_.checked&&d.checked)&&(i=8.5),_.checked&&d.checked&&(i=3.5);break;case"consumer":s=p,p<75e4&&(i=15),p>=75e4&&p<2e6&&(i=12.5),p>=2e6&&(i=9.5),document.getElementById("calculator-checkbox-salary").checked&&(i-=.5);break;default:s=p}var q=!1;switch(t){case"mortgage":s>=5e5&&(q=!0);break;case"car":s>=2e5&&(q=!0);break;case"consumer":q=!0;break;default:q=!1}if(!q)switch(t){case"mortgage":r.querySelector(".calculator__message_mortgage").classList.add("calculator__message_active");break;case"car":r.querySelector(".calculator__message_car").classList.add("calculator__message_active")}var f=i/100/12,S=12*v;return a=parseInt(s*(f+f/(Math.pow(1+f,S)-1)),10),c=parseInt(a/.45,10),q&&(o.innerHTML=a,l.innerHTML=s,n.innerHTML=i,u.innerHTML=c,Q(a,o.parentNode.querySelector(".calculator__offer-currency"),"roubles"),Q(s,l.parentNode.querySelector(".calculator__offer-currency"),"roubles"),Q(c,u.parentNode.querySelector(".calculator__offer-currency"),"roubles"),m.classList.add("calculator__offer_active")),{goal:e.dataset.type,priceName:e.dataset.pricename,creditType:t,price:p,initial:g,term:v}};v.addEventListener("click",function(e){e.preventDefault();var t=x(),a=t.toString().length,c="";if(a<4)for(var l=4-a;0!==l;)c+="0",l--;c+=t.toString(),document.getElementById("request-initial").innerHTML="",document.getElementById("request-initial").parentNode.querySelector(".calculator__request-currency").innerHTML="",y.classList.add("calculator__request_active"),document.getElementById("request-goal").innerHTML=H.goal,document.getElementById("request-number").innerHTML=c,document.getElementById("request-price").parentNode.parentNode.querySelector(".calculator__descr").innerHTML=H.priceName,document.getElementById("request-price").innerHTML=H.price,document.getElementById("request-price").innerHTML=H.price,Q(H.price,document.getElementById("request-price").parentNode.querySelector(".calculator__request-currency"),"roubles"),H.initial&&(document.getElementById("request-initial").innerHTML=H.initial,Q(H.initial,document.getElementById("request-initial").parentNode.querySelector(".calculator__request-currency"),"roubles")),document.getElementById("request-term").innerHTML=H.term,Q(H.term,document.getElementById("request-term").parentNode.querySelector(".calculator__request-years"),"years"),window.scrollTo({top:r.offsetTop+y.offsetTop,left:0,behavior:"smooth"})}),S.addEventListener("submit",function(e){e.preventDefault(),f=!0,x(),y.classList.remove("calculator__request_active"),m.classList.remove("calculator__offer_active"),f=!1;var t={name:document.getElementById("request-name").value,email:document.getElementById("request-email").value,tel:document.getElementById("request-tel").value};if(0===T.length&&N.getItem("requests"))for(var r=0;r<JSON.parse(N.getItem("requests")).length;r++)T.push(JSON.parse(N.getItem("requests"))[r]);T.push(t),N.setItem("requests",JSON.stringify(T))});var Q=function(e,t,r){var a,c=e%100;switch(e%10){case 1:11!==c&&(a="a"),11===c&&(a="c");break;case 2:case 3:case 4:12!==c&&13!==c&&14!==c&&(a="b"),12!==c&&13!==c&&14!==c||(a="c");break;default:a="c"}switch(r){case"roubles":t.innerHTML={a:"рубль",b:"рубля",c:"рублей"}[a];break;case"years":t.innerHTML={a:"год",b:"года",c:"лет"}[a]}}}();